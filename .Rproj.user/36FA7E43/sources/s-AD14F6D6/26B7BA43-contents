#libraries
library(careless)
library(tidyr)

#import data
df <- read.csv("prelim_data/full.wide.csv", header=TRUE)


"DATA PREPARATION FROM RAW FILE
1. Delete unnecessary rows
2. Delete unnecessary columns
3. Delete cases that fail ATCs
4. Screen extremely fast response
5. Recode response options
6. Recode reverse scored items
7. Change variable classes
8. Restructure dataframes
9. Screen careless responding
10. Create subset datasets
11. Compute scale scores
12. Export to CSV files
"

## 1.DELETE ROWS ##
# Delete unnecessary rows ##
df <- slice(df, -c(1:2))

# Delete all cases that did not agree to consent #
df <- subset(df, IC!="No, I do not want to be in this research study.")

# Delete cases that were practice runs by researchers #
df <- subset(df, JOB1!="cory test" & JOB1!="a")



## 2. DELETE COLUMNS ##
df <- df %>%
  select(-c(StartDate,
            EndDate,
            Status,
            IPAddress,
            Progress,
            Finished,
            RecordedDate,
            ResponseId,
            RecipientLastName,
            RecipientFirstName,
            RecipientEmail,
            ExternalReference,
            LocationLatitude,
            LocationLongitude,
            DistributionChannel,
            UserLanguage,
            IC,
            TIMEA_First.Click,
            TIMEA_Last.Click,
            TIMEA_Page.Submit,
            TIMEA_Click.Count,
            TIMEB_First.Click,
            TIMEB_Last.Click,
            TIMEB_Page.Submit,
            TIMEB_Click.Count,
            ATC3,
            GROUP))


## 3.DELETE CASES THAT FAIL ATCs ##
df <- subset(df, 
               ATC1=="Strongly agree" & 
               ATC2=="Somewhat disagree" & 
               ATC4=="Neither agree nor disagree" & 
               OCP1B_17=="Very much") 


## 4. DELETE FAST RESPONSE ##
df$Duration..in.seconds. <- as.numeric(df$Duration..in.seconds.)
df <- df %>% 
  filter(Duration..in.seconds. > 300)

# delete ATCs and Duration columns
df <- df %>%
  select(-c(Duration..in.seconds.,
            ATC1,
            ATC2,
            ATC4))


### 5. RECODE RESPONSE OPTIONS ###
df[df=="Strongly disagree"] <- 1
df[df=="Somewhat disagree"] <- 2
df[df=="Neither agree nor disagree"] <-3
df[df=="Somewhat agree"] <- 4
df[df=="Strongly agree"] <- 5
df[df=="Not at all"] <- 1
df[df=="Minimally"] <- 2
df[df=="Moderately"] <- 3
df[df=="Considerably"] <- 4
df[df=="Very much"] <- 5



### 6. CHANGE VARIABLE CLASSES ###
df[,2:100] <- lapply(df[,2:100], as.numeric)

# recode for reverse scored items 
df$GA1A <- 6 - df$GA1A



### 7. SCREEN CARELESS RESPONSE #
longstring <- longstring(df[,2:100], avg=TRUE)
boxplot(longstring)
longstring
ls <- longstring$longstr
df$ls <- ls #bind ls values to df 
names(df)
df <- df %>% 
  filter(ls < 18)




