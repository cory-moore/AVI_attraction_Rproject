#libraries
library(careless)
library(tidyr)
library(dplyr)
library(reshape2)

#import data
df <- read.csv("prelim_data/full.wide.csv", header=TRUE)


"DATA PREPARATION FROM RAW FILE
-Delete unnecessary rows
-Delete unnecessary columns
-Delete cases that fail ATCs
-Screen extremely fast response
-Recode response options
-Change variable classes
-Recode reverse scored items
-Screen careless responding
-Restructure dataframes 
-Compute scale scores
-create subsets
-Export to CSV files
"

## DELETE ROWS ##
# Delete unnecessary rows ##
df <- slice(df, -c(1:2))

# Delete all cases that did not agree to consent #
df <- subset(df, IC!="No, I do not want to be in this research study.")

# Delete cases that were practice runs by researchers #
df <- subset(df, JOB1!="cory test" & JOB1!="a")



## DELETE COLUMNS ##
df <- df %>%
  select(-c(StartDate,
            EndDate,
            Status,
            IPAddress,
            Progress,
            Finished,
            RecordedDate,
            ResponseId,
            RecipientLastName,
            RecipientFirstName,
            RecipientEmail,
            ExternalReference,
            LocationLatitude,
            LocationLongitude,
            DistributionChannel,
            UserLanguage,
            IC,
            TIMEA_First.Click,
            TIMEA_Last.Click,
            TIMEA_Page.Submit,
            TIMEA_Click.Count,
            TIMEB_First.Click,
            TIMEB_Last.Click,
            TIMEB_Page.Submit,
            TIMEB_Click.Count,
            ATC3,
            GROUP))


## DELETE CASES THAT FAIL ATCs ##
df <- subset(df, 
               ATC1=="Strongly agree" & 
               ATC2=="Somewhat disagree" & 
               ATC4=="Neither agree nor disagree" & 
               OCP1B_17=="Very much") 


## DELETE FAST RESPONSE ##
df$Duration..in.seconds. <- as.numeric(df$Duration..in.seconds.)
df <- df %>% 
  filter(Duration..in.seconds. > 300)

# delete ATCs and Duration columns
df <- df %>%
  select(-c(Duration..in.seconds.,
            ATC1,
            ATC2,
            ATC4,
            OCP1B_17))


### RECODE RESPONSE OPTIONS ###
df[df=="Strongly disagree"] <- 1
df[df=="Somewhat disagree"] <- 2
df[df=="Neither agree nor disagree"] <-3
df[df=="Somewhat agree"] <- 4
df[df=="Strongly agree"] <- 5
df[df=="Not at all"] <- 1
df[df=="Minimally"] <- 2
df[df=="Moderately"] <- 3
df[df=="Considerably"] <- 4
df[df=="Very much"] <- 5



### CHANGE VARIABLE CLASSES ###
df[,2:99] <- lapply(df[,2:99], as.numeric)


### RECODE REVERSE SCORED ITEMS ###
df$GA1A <- 6 - df$GA1A


### SCREEN CARELESS RESPONSE #
longstring <- longstring(df[,2:100], avg=TRUE)
boxplot(longstring)
longstring
ls <- longstring$longstr
df$ls <- ls #bind ls values to df 
names(df)

df <- df %>% #deletes cases with longstrings >= 15
  filter(ls < 15)

df$ls <- NULL #remove ls column
rm(ls, longstring)


### RESTRUCTURE DATAFRAME / CREATE SUBSETS ###
#create item and demo subset 
items <- df[,2:99]
demogr <- df[c(1, 100:115)]


### COMPUTE (MEAN) SCALE SCORES ###
items$procjustA <- round(with(items,(TBD1A+TBD2A+CJR1A+PJR1A+OTP1A+COA1A+COA2A+COA3A+RO1A) / 9),2) #procedural justice A

items$procjustB <- round(with(items,(TBD1B+TBD2B+CJR1B+PJR1B+OTP1B+COA1B+COA2B+COA3B+RO1B) / 9),2) #procedural justice B

items$interjustA <- round(with(items, (TRM1A+TRM2A+TRM3A+TRM4A+TWC1A+TWC2A+TWC3A+TWC4A+TWC5A) / 9),2) #interpersonal justice A

items$interjustB <- round(with(items, (TRM1B+TRM2B+TRM3B+TRM4B+TWC1B+TWC2B+TWC3B+TWC4B+TWC5B) / 9),2) #interpersonal justice A

items$orgjustA <- round(with(items, (procjustA + interjustA) / 2),2) #organizational justice A

items$orgjustB <- round(with(items, (procjustA + interjustA) / 2),2) #organizational justice B

items$genatrctA <- round(with(items, (GA1A+GA2A+GA3A+GA4A+GA5A) / 5),2) #general attraction A

items$genatrctB <- round(with(items, (GA1B+GA2B+GA3B+GA4B+GA5B) / 5),2) #general attraction B

items$intpursA <- round(with(items, (IP1A+IP2A+IP3A+IP4A+IP5A) / 5),2) #intent to pursue A

items$intpursB <- round(with(items, (IP1B+IP2B+IP3B+IP4B+IP5B) / 5),2) #intent to pursue B

items$prestA <- round(with(items, (PRS1A+PRS2A+PRS3A+PRS4A+PRS5A) / 5),2) #prestige A

items$prestB <- round(with(items, (PRS1B+PRS2B+PRS3B+PRS4B+PRS5B) / 5),2) #prestige B

items$orgatrctA <- round(with(items, (genatrctA+intpursA+prestA) / 3),2) #organizational attraction A

items$orgatrctB <- round(with(items, (genatrctB+intpursB+prestB) / 3),2) #organizational attraction B

items$competeA <- round(with(items, (OCP1A_1+OCP1A_2+OCP1A_3+OCP1A_4) / 4),2) #competitiveness A

items$competeB <- round(with(items, (OCP1B_1+OCP1B_2+OCP1B_3+OCP1B_4) / 4),2) #competitiveness B

items$socrespA <- round(with(items, (OCP1A_5+OCP1A_6+OCP1A_7+OCP1A_8) / 4),2) #social responsibility A

items$socrespB <- round(with(items, (OCP1B_5+OCP1B_6+OCP1B_7+OCP1B_8) / 4),2) #social responsibility B

items$supportA <- round(with(items, (OCP1A_9+OCP1A_10+OCP1A_11+OCP1A_12) / 4),2) #supportiveness A

items$supportB <- round(with(items, (OCP1B_9+OCP1B_10+OCP1B_11+OCP1B_12) / 4),2) #supportiveness B

items$innovateA <- round(with(items, (OCP1A_13+OCP1A_14+OCP1A_15+OCP1A_16) / 4),2) #innovativeness A

items$innovateB <- round(with(items, (OCP1B_13+OCP1B_14+OCP1B_15+OCP1B_16) / 4),2) #innovativeness B


#create scale subset
scales.wide <- items[,99:120]
id <- 1:90
scales.wide$id <- id #creating ID to track subject
scales.long <- melt(scales.wide, id.vars = "id", variable.name = "procjust")


"
STUCK RIGHT HERE!!!
the code below is a last resort method, but there must be something cleaner
"


procjustA <- round(with(items,(TBD1A+TBD2A+CJR1A+PJR1A+OTP1A+COA1A+COA2A+COA3A+RO1A) / 9),2) #procedural justice A

procjustB <- round(with(items,(TBD1B+TBD2B+CJR1B+PJR1B+OTP1B+COA1B+COA2B+COA3B+RO1B) / 9),2) #procedural justice B

test <- data.frame(procjustA, procjustB)

test2 <- gather(test, key="procjust", value="procjust", 1:2)

interjustA <- round(with(items, (TRM1A+TRM2A+TRM3A+TRM4A+TWC1A+TWC2A+TWC3A+TWC4A+TWC5A) / 9),2) #interpersonal justice A

interjustB <- round(with(items, (TRM1B+TRM2B+TRM3B+TRM4B+TWC1B+TWC2B+TWC3B+TWC4B+TWC5B) / 9),2) #interpersonal justice A

test3 <- data.frame(interjustA, interjustB)

test4 <- gather(test3, key="interjust", value="interjust", 1:2)


