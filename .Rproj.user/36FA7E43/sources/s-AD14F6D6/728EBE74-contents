#libraries                 
library(psych)
library(car)
library(dplyr)
library(ggplot2)
library(apaTables)
library(corrplot)
library(Hmisc)
library(ggcorrplot)
library(xlsx)


#import data
scales <- read.csv("data/cleaned_scaledata_long.csv", header=TRUE)


#rename and recode 
scales <- scales %>%
  rename(id = id,
         Sex = sex,
         Ethnicity = ethnicity,
         Age = age,
         Employment = employ1,
         Condition = condition,
         AVI = AVI.id,
         Procedural_Justice=procjust,
         Interpersonal_Justice=interjust,
         Organizational_Justice=orgjust,
         General_Attractiveness = genatrct,
         Intent_to_Pursue = intpurs, 
         Prestige = prest,
         Organizational_Attraction = orgatrct,
         Competiveness =compete,
         Social_Responsibility = socresp,
         Supportiveness = support,
         Innovativeness = innovate)


scales$Sex <- as.numeric(recode(scales$Sex, 
                     "Male" = "1",
                     "Female" = "2",
                     "Other" = "3",
                     "Prefer not to respond" = "4"))
scales$Ethnicity <- as.numeric(recode(scales$Ethnicity,
                           "White" = "1",
                           "Black or African American" = "2",
                           "American Indian or Alaska Native" = "3",
                           "Asian" = "4",
                           "Native Hawaiian or Pacific Islander" = "5",
                           "Other" = "6",
                           "Prefer not to respond" = "7"))
scales$Employment <- as.numeric(recode(scales$Employment,
                                       "Employed full time" = "1",
                                       "Employed part time" = "2",
                                       "Unemployed looking for work" = "3",
                                       "Unemployed not looking for work" = "4",
                                       "Retired" = "5",
                                       "Student" = "6"))
scales$Age <- as.numeric(scales$Age)

scales$Condition <- NULL
      
                  


"##########################
DATA ANALYSIS:
correlations
regression
mediation
###########################"

##### first, create data subsets for correlations #####
prim.corr.df <- subset(scales, 
                       select=c(Sex,
                                Ethnicity,
                                Age,
                                Employment,
                                AVI,
                                Organizational_Justice,
                                Organizational_Attraction,
                                Competiveness,
                                Social_Responsibility,
                                Supportiveness,
                                Innovativeness)) #df for cor's both conditions

corr.df <- scales[,2:17] #subscales both conditions

corr.df.AVI <- scales[scales$AVI == "1",] ##dfs for cor's for AVI cond
corr.df.AVI <- corr.df.AVI[,2:17] ## subscales
corr.df.AVI <- subset(corr.df.AVI, 
                      select=c(Sex,
                               Ethnicity,
                               Age,
                               Employment,
                               Organizational_Justice,
                               Organizational_Attraction,
                               Competiveness,
                               Social_Responsibility,
                               Supportiveness,
                               Innovativeness)) #broad scales

corr.df.trad <- scales[scales$AVI== "0",] ##df for cor's for AVI cond
corr.df.trad <- corr.df.trad[,2:17] #subscales
corr.df.trad <- subset(corr.df.trad, 
                       select=c(Sex,
                                Ethnicity,
                                Age,
                                Employment,
                                Organizational_Justice,
                                Organizational_Attraction,
                                Competiveness,
                                Social_Responsibility,
                                Supportiveness,
                                Innovativeness)) #broad scales



##### correlation analyses #####
prim.corr.matrix <- round(cor(prim.corr.df, use = "complete.obs"),3)
ggcorrplot(prim.corr.matrix, title = "Full Scales", lab=TRUE) 
prim.corr.matrix

corr.matrix <- round(cor(corr.df, use = "complete.obs"),3) 
ggcorrplot(corr.matrix, title = "Subscales", lab=TRUE) 
corr.matrix

corr.matrix.AVI <- round(cor(corr.df.AVI, use = "complete.obs"),3) 
ggcorrplot(corr.matrix.AVI, title="Full Scales, AVI Condition", lab=TRUE)
corr.matrix.AVI

corr.matrix.trad <- round(cor(corr.df.trad, use = "complete.obs"),3) 
ggcorrplot(corr.matrix.trad, title="Full Scales, Traditional Condition", lab=TRUE)
corr.df.trad



#excel
write.xlsx(as.data.frame(prim.corr.matrix), file="output/output.xlsx",sheetName="cor.primary", col.names=TRUE,row.names=TRUE,append=TRUE)

write.xlsx(as.data.frame(corr.matrix), file="output/output.xlsx",sheetName="cor.subscales",col.names=TRUE,row.names=TRUE,append=TRUE)

write.xlsx(as.data.frame(corr.matrix.AVI), file="output/output.xlsx",sheetName="cor.AVI",col.names=TRUE,row.names=TRUE,append=TRUE)

write.xlsx(as.data.frame(corr.matrix.trad), file="output/output.xlsx",sheetName="cor.Trad",col.names=TRUE,row.names=TRUE,append=TRUE)


rm(prim.corr.df, cor, corr.df, corr.df.AVI, corr.df.trad, corr.matrix, corr.matrix.AVI, corr.matrix.trad, prim.corr.matrix)



###### REGRESSIONs ######
max.mod <- lm(Organizational_Attraction ~ AVI + Organizational_Justice + Innovativeness + Supportiveness + Social_Responsibility + Competiveness, data = scales) 
summary(max.mod)
anova(max.mod)

mod1 <- lm(Organizational_Justice ~ AVI, data=scales)
summary(mod1)
anova(mod1)

mod2 <- lm(Competiveness ~ AVI, data=scales)
summary(mod2)

mod3 <- lm(Social_Responsibility ~ AVI, data=scales)
summary(mod3)

mod4 <- lm(Innovativeness ~ AVI, data=scales)
summary(mod4)

mod5 <- lm(Supportiveness ~ AVI, data=scales)
summary(mod5)

mod6 <- lm(Organizational_Attraction ~ AVI, data=scales)
summary(mod6)

mod7 <- lm(Organizational_Attraction ~ Organizational_Justice, data=scales)
summary(mod7)

mod8 <- lm(Organizational_Attraction ~ Competiveness, data=scales)
summary(mod8)

mod9 <- lm(Organizational_Attraction ~ Social_Responsibility, data=scales)
summary(mod9)

mod10 <- lm(Organizational_Attraction ~ Innovativeness, data=scales)
summary(mod10)

mod11 <- lm(Organizational_Attraction ~ Supportiveness, data=scales)
summary(mod11)


##### MEDIATIONs #####

#simple mediation models
m1 <- mediate(Organizational_Attraction ~ AVI + (Organizational_Justice), data=scales)
summary(m1)
m1

m2 <- mediate(Organizational_Attraction ~ AVI + (Competiveness), data=scales)
summary(m2)
m2

m3 <- mediate(Organizational_Attraction ~ AVI + (Social_Responsibility), data=scales)
summary(m3)
m3

m4 <- mediate(Organizational_Attraction ~ AVI + (Innovativeness), data=scales)
summary(m4)
m4

m5 <- mediate(Organizational_Attraction ~ AVI + (Supportiveness), data=scales)
summary(m5)
m5

mm.max <- mediate(Organizational_Attraction ~ AVI + (Organizational_Justice) + (Innovativeness) + (Social_Responsibility) + (Supportiveness) + (Competiveness), data=scales)
summary(mm.max)
mm.max

